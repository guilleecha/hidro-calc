{% extends "base.html" %}
{% load static %}

{% block extra_css %}
{# CSS modular ya incluido en main.css #}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìä Curvas IDF Uruguay - Calculadora R√°pida</h1>
    <p class="page-description">
        C√°lculo de Intensidad-Duraci√≥n-Frecuencia seg√∫n ecuaciones de Rodr√≠guez Fontal (1980)
    </p>
    <p class="page-description">
        <small>
            üí° <strong>¬øNecesitas guardar tus c√°lculos?</strong>
            Usa <a href="/studio">HidroStudio Professional</a> para gestionar proyectos completos.
        </small>
    </p>
</div>

<div class="content-layout">
    <!-- Formulario de Entrada -->
    <div class="form-section">
        <div class="card">
            <h2>üìä Datos de Entrada</h2>

            <form id="idfForm">
                <!-- Precipitaci√≥n P3,10 -->
                <div class="form-group">
                    <label for="P3_10" class="form-label">
                        Precipitaci√≥n P‚ÇÉ,‚ÇÅ‚ÇÄ
                        <span class="tooltip" title="Precipitaci√≥n de 3 horas y 10 a√±os de per√≠odo de retorno">‚ÑπÔ∏è</span>
                    </label>
                    <div class="input-group">
                        <input
                            type="number"
                            id="P3_10"
                            name="P3_10"
                            class="form-input"
                            min="50"
                            max="100"
                            step="0.1"
                            value="75"
                            required
                        >
                        <span class="input-unit">mm</span>
                    </div>
                    <small class="form-help">Valor entre 50-100 mm. Usa el selector de ciudad o consulta mapas de isoyetas</small>
                    <div class="form-error" id="error-P3_10"></div>
                </div>

                <!-- Selector de Ciudad -->
                <div class="form-group">
                    <label for="city" class="form-label">
                        Seleccionar Ciudad de Referencia
                    </label>
                    <select id="city" name="city" class="form-input">
                        <option value="">-- Seleccionar ciudad --</option>
                        {% for city, value in p3_10_values.items %}
                        <option value="{{ value }}" {% if city == "Montevideo" %}selected{% endif %}>
                            {{ city }} ({{ value }} mm)
                        </option>
                        {% endfor %}
                    </select>
                    <small class="form-help">Selecciona una ciudad para usar su valor de P‚ÇÉ,‚ÇÅ‚ÇÄ</small>
                </div>

                <!-- Per√≠odo de Retorno -->
                <div class="form-group">
                    <label for="Tr" class="form-label">
                        Per√≠odo de Retorno (Tr)
                        <span class="tooltip" title="Intervalo promedio entre eventos de igual o mayor magnitud">‚ÑπÔ∏è</span>
                    </label>
                    <div class="input-group">
                        <input
                            type="number"
                            id="Tr"
                            name="Tr"
                            class="form-input"
                            min="2"
                            max="200"
                            step="1"
                            value="10"
                            required
                        >
                        <span class="input-unit">a√±os</span>
                    </div>
                    <small class="form-help">
                        T√≠pico: Residencial=5, Comercial=10, Obras mayores=25-50 a√±os
                    </small>
                    <div class="form-error" id="error-Tr"></div>
                </div>

                <!-- Duraci√≥n de la Tormenta -->
                <div class="form-group">
                    <label for="d" class="form-label">
                        Duraci√≥n de la Tormenta (d)
                        <span class="tooltip" title="Duraci√≥n de la lluvia, t√≠picamente igual al tiempo de concentraci√≥n">‚ÑπÔ∏è</span>
                    </label>
                    <div class="input-group">
                        <input
                            type="number"
                            id="d"
                            name="d"
                            class="form-input"
                            min="0.1"
                            max="48"
                            step="0.1"
                            value="1"
                            required
                        >
                        <span class="input-unit">horas</span>
                    </div>
                    <small class="form-help">
                        Usa la <a href="/calculators/tc">Calculadora de Tc</a> para obtener el tiempo de concentraci√≥n
                    </small>
                    <div class="form-error" id="error-d"></div>
                </div>

                <!-- √Årea de Cuenca (Opcional) -->
                <div class="form-group">
                    <label for="Ac" class="form-label">
                        √Årea de Cuenca (Ac) - Opcional
                        <span class="tooltip" title="√Årea de la cuenca para aplicar correcci√≥n por √°rea">‚ÑπÔ∏è</span>
                    </label>
                    <div class="input-group">
                        <input
                            type="number"
                            id="Ac"
                            name="Ac"
                            class="form-input"
                            min="0"
                            max="1000"
                            step="0.1"
                            placeholder="Dejar vac√≠o para intensidad puntual"
                        >
                        <span class="input-unit">km¬≤</span>
                    </div>
                    <small class="form-help">
                        Dejar vac√≠o para calcular intensidad puntual (sin correcci√≥n por √°rea)
                    </small>
                    <div class="form-error" id="error-Ac"></div>
                </div>

                <!-- Botones de Acci√≥n -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="calculateBtn">
                        üßÆ Calcular Intensidad
                    </button>
                    <button type="reset" class="btn btn-secondary">
                        üîÑ Limpiar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Resultados -->
    <div class="results-section">
        <!-- Mensaje inicial -->
        <div id="resultsContainer" class="card empty-state">
            <div class="empty-icon">üìä</div>
            <h3>Resultados IDF</h3>
            <p>Completa el formulario y presiona "Calcular Intensidad" para ver los resultados.</p>
        </div>

        <!-- Contenido de resultados (oculto inicialmente) -->
        <div id="resultsContent" class="card" style="display: none;">
            <h2>üìà Resultados del C√°lculo IDF</h2>

            <!-- Resultados Principales -->
            <div class="results-grid">
                <div class="result-item highlight">
                    <label>Intensidad (I)</label>
                    <div class="result-value">
                        <span id="result-I-mmh">-</span>
                        <span class="result-unit">mm/h</span>
                    </div>
                </div>

                <div class="result-item">
                    <label>Precipitaci√≥n Total (P)</label>
                    <div class="result-value">
                        <span id="result-P-mm">-</span>
                        <span class="result-unit">mm</span>
                    </div>
                </div>
            </div>

            <!-- Factores de Correcci√≥n -->
            <div class="factors-section">
                <h3>Factores de Correcci√≥n</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <label>CT (Per√≠odo de Retorno)</label>
                        <div class="result-value">
                            <span id="result-CT">-</span>
                        </div>
                    </div>

                    <div class="result-item">
                        <label>CD (Duraci√≥n)</label>
                        <div class="result-value">
                            <span id="result-CD">-</span>
                        </div>
                    </div>

                    <div class="result-item">
                        <label>CA (√Årea)</label>
                        <div class="result-value">
                            <span id="result-CA">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Par√°metros de Entrada -->
            <div class="parameters-section">
                <h3>Par√°metros Utilizados</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <label>P‚ÇÉ,‚ÇÅ‚ÇÄ</label>
                        <div class="result-value">
                            <span id="result-input-P3_10">-</span>
                            <span class="result-unit">mm</span>
                        </div>
                    </div>

                    <div class="result-item">
                        <label>Tr</label>
                        <div class="result-value">
                            <span id="result-input-Tr">-</span>
                            <span class="result-unit">a√±os</span>
                        </div>
                    </div>

                    <div class="result-item">
                        <label>Duraci√≥n</label>
                        <div class="result-value">
                            <span id="result-input-d">-</span>
                            <span class="result-unit">horas</span>
                        </div>
                    </div>

                    <div class="result-item">
                        <label>√Årea Cuenca</label>
                        <div class="result-value">
                            <span id="result-input-Ac">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advertencias -->
            <div id="warningsContainer" class="warnings" style="display: none;">
                <h3>‚ö†Ô∏è Advertencias</h3>
                <ul id="warningsList"></ul>
            </div>

            <!-- F√≥rmula -->
            <div class="formula-box">
                <h3>F√≥rmula Utilizada</h3>
                <div class="formula">
                    I = (P‚ÇÉ,‚ÇÅ‚ÇÄ √ó CT √ó CD √ó CA) / d
                </div>
                <p class="formula-note">
                    Donde:<br>
                    I = Intensidad (mm/h)<br>
                    P‚ÇÉ,‚ÇÅ‚ÇÄ = Precipitaci√≥n de 3h y 10 a√±os (mm)<br>
                    CT = Factor de correcci√≥n por per√≠odo de retorno<br>
                    CD = Factor de correcci√≥n por duraci√≥n<br>
                    CA = Factor de correcci√≥n por √°rea<br>
                    d = Duraci√≥n (horas)
                </p>
            </div>

            <!-- Acciones de Exportaci√≥n -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="exportPdfBtn" disabled>
                    üìÑ Exportar PDF
                </button>
                <button type="button" class="btn btn-secondary" id="exportExcelBtn" disabled>
                    üìä Exportar Excel
                </button>
            </div>
        </div>

        <!-- Informaci√≥n Adicional -->
        <div class="card info-card">
            <h3>‚ÑπÔ∏è Acerca de las Curvas IDF</h3>
            <p>
                Las curvas IDF (Intensidad-Duraci√≥n-Frecuencia) relacionan la intensidad de lluvia
                con su duraci√≥n y per√≠odo de retorno para una ubicaci√≥n espec√≠fica.
            </p>
            <p><strong>Aplicaciones:</strong></p>
            <ul>
                <li>Dise√±o de sistemas de drenaje pluvial</li>
                <li>Dimensionamiento de alcantarillado</li>
                <li>C√°lculo de caudales de dise√±o (M√©todo Racional)</li>
                <li>Estudios de crecidas y control de inundaciones</li>
            </ul>
            <p><strong>Referencias:</strong></p>
            <ul>
                <li>Rodr√≠guez Fontal (1980) - Curvas IDF de Uruguay</li>
                <li>Genta et al. (1998) - Actualizaci√≥n de curvas IDF</li>
                <li>Per√≠odo de datos: 1906-1980</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/idf.js' %}"></script>
{% endblock %}
